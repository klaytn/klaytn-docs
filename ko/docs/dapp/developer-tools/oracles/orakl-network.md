# ì†Œê°œ

![](../images/klaytnXorakl.png)

[Orakl Network](https://docs.orakl.network/docs/developers-guide/readme)ëŠ” ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ê°€ ì˜¤í”„ì²´ì¸ ë°ì´í„° ë° ê¸°íƒ€ ë¦¬ì†ŒìŠ¤ì— ì•ˆì „í•˜ê²Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìžˆë„ë¡ í•˜ëŠ” íƒˆì¤‘ì•™í™” ì˜¤ë¼í´ ë„¤íŠ¸ì›Œí¬ìž…ë‹ˆë‹¤. ë°ì´í„° í”¼ë“œ, VRF, ìš”ì²­-ì‘ë‹µ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ëŠ” Klaytn ë„¤ì´í‹°ë¸Œ ì˜¤ë¼í´ì´ë¼ëŠ” ìžë¶€ì‹¬ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤.

Orakl Networkë¥¼ í†µí•´ ì‚¬ìš©ìžëŠ” ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì—ì„œ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•˜ê³  íŽ¸í–¥ë˜ì§€ ì•Šì€ ë¬´ìž‘ìœ„ì„±ì„ í™•ë³´í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. Orakl Networkì˜ [ê²€ì¦ ê°€ëŠ¥í•œ ëžœë¤ í•¨ìˆ˜(VRF)](https://docs.orakl.network/docs/developers-guide/verifiable-random-function-vrf#what-is-verifiable-random-function)ë¥¼ í†µí•´ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ëŠ” VRFë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ì¦ ê°€ëŠ¥í•œ ëžœë¤ ê°’ì„ ìƒì„±í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ëŠ” ë¬´ìž‘ìœ„ì„±ì´ í•„ìš”í•œ ë‹¤ì–‘í•œ ë””ì•±ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.


ì˜¤ë¼í´ ë„¤íŠ¸ì›Œí¬ëŠ” ê°œë°œìžì—ê²Œ ë‘ ê°€ì§€ ê²°ì œ ë°©ë²•ì„ í†µí•´ VRF ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤: [ì„ ë¶ˆ](https://docs.orakl.network/docs/developers-guide/readme#prepayment) ë˜ëŠ” [ì§ì ‘ ê²°ì œ](https://docs.orakl.network/docs/developers-guide/readme#direct-payment). ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ì˜¤ë¼í´ ë„¤íŠ¸ì›Œí¬ì˜ VRF ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì—ì„œ ë‚œìˆ˜ë¥¼ ìš”ì²­í•´ë³¼ ê²ƒìž…ë‹ˆë‹¤.


# ì¤€ë¹„ ì‚¬í•­
* [Kaikas](https://chrome.google.com/webstore/detail/kaikas/jblndlipeogpafnldhgmapagcccfchpi?hl=en)
* [Remix IDE](https://remix.ethereum.org/)
* [Remixì˜ Klaytn í”ŒëŸ¬ê·¸ì¸](https://klaytn.foundation/using-klaytn-plugin-on-remix/)
* [Faucet](https://baobab.wallet.klaytn.foundation/faucet)ì—ì„œ ì–»ì€ í…ŒìŠ¤íŠ¸ KLAY

# ì‹œìž‘í•˜ê¸°

ë‹¤ìŒ ë‹¨ê³„ë“¤ì—ì„œëŠ” Orakle Networkë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì—ì„œ ë‚œìˆ˜ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. ì‹œìž‘í•´ ë´…ì‹œë‹¤!

## 1ë‹¨ê³„: ì§ì ‘ ê²°ì œë¥¼ ìœ„í•œ ì´ˆê¸° ì„¤ì •

ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì—ì„œ ë‚œìˆ˜ë¥¼ ìš”ì²­í•˜ë ¤ë©´ [VRFCoordinator](https://github.com/Bisonai-CIC/orakl/blob/master/contracts/src/v0.1/VRFCoordinator.sol) ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì˜ ì´ˆê¸° ì„¤ì •ì„ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.  ìƒì„±ìž íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ì œê³µëœ VRFCoordinator ì£¼ì†Œì— VRFCoordinator ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ì—¬ ëžœë¤ ì›Œë“œ ìš”ì²­(requestRandomWordsPayment)ì— ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œìž¥í•©ë‹ˆë‹¤. í˜„ìž¬ Klaytn í…ŒìŠ¤íŠ¸ë„· Baobabì— ì»¨íŠ¸ëž™íŠ¸ ì£¼ì†Œ [0xfa605ca6dc9414e0f7fa322d3fd76535b33f7a4f](https://baobab.scope.klaytn.com/account/0xfa605ca6dc9414e0f7fa322d3fd76535b33f7a4f)ë¡œ VRFCoordinator ì»¨íŠ¸ëž™íŠ¸ê°€ ë°°í¬ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.


```solidity
import "@bisonai/orakl-contracts/src/v0.1/VRFConsumerBase.sol";
import "@bisonai/orakl-contracts/src/v0.1/interfaces/VRFCoordinatorInterface.sol";

contract VRFConsumer is VRFConsumerBase {
  VRFCoordinatorInterface COORDINATOR;
  constructor(address coordinator) VRFConsumerBase(coordinator) {
      COORDINATOR = VRFCoordinatorInterface(coordinator);
  }
}
```
## 2ë‹¨ê³„: ì»¨íŠ¸ëž™íŠ¸ ìƒíƒœ ë³€ìˆ˜ ì´ˆê¸° ì„¤ì •

ì´ ë‹¨ê³„ì—ì„œëŠ” ì»¨íŠ¸ëž™íŠ¸ ê¸°ëŠ¥ì— í•„ìš”í•œ ìƒíƒœ ë³€ìˆ˜ì˜ ì´ˆê¸° ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ë‚œìˆ˜ ê²°ê³¼ë¥¼ ì €ìž¥í•˜ëŠ” s_randomResult ë³€ìˆ˜, onlyOwner ëª¨ë””íŒŒì´ì–´ì—ì„œ ì‚¬ìš©ë˜ëŠ” s_owner ë³€ìˆ˜, callbackGasLimit ë³€ìˆ˜, ë°˜í™˜í•  ë‚œìˆ˜ì˜ ê°œìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” keyHash ë³€ìˆ˜ ë° numWord ë³€ìˆ˜ê°€ í¬í•¨ë©ë‹ˆë‹¤.

```solidity
  uint256 public s_randomResult;

  address private sOwner;

   bytes32 keyHash = 0x47ede773ef09e40658e643fe79f8d1a27c0aa6eb7251749b268f829ea49f2024;

   uint32 callbackGasLimit = 500000;

   uint32 numWords = 1;

  error OnlyOwner(address notOwner);
  modifier onlyOwner() {
      if (msg.sender != sOwner) {
          revert OnlyOwner(msg.sender);
      }
      _;
  }
  constructor(address coordinator) VRFConsumerBase(coordinator) {
      COORDINATOR = VRFCoordinatorInterface(coordinator);
      sOwner = msg.sender;
  }
```

## 3ë‹¨ê³„: ì§ì ‘ ê²°ì œë¡œ ë¬´ìž‘ìœ„ ì›Œë“œ ìš”ì²­í•˜ê¸°

ì§ì ‘ ê²°ì œë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚œìˆ˜ë¥¼ ìš”ì²­í•˜ë ¤ë©´ ì‚¬ìš©ìžëŠ” value ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ í˜¸ì¶œê³¼ í•¨ê»˜ $KLAYë¥¼ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.

```solidity

receive() external payable {}

function requestRandomWordsDirect(
    bytes32 keyHash,
    uint32 callbackGasLimit,
    uint32 numWords
)
    public
    payable
    onlyOwner
    returns (uint256 requestId)
{
  requestId = COORDINATOR.requestRandomWordsPayment{value: msg.value}(
    keyHash,
    callbackGasLimit,
    numWords
  );
}
```
ìœ„ ì½”ë“œëŠ” ì½”ë””ë„¤ì´í„° ì»¨íŠ¸ëž™íŠ¸ì— ì •ì˜ëœ `requestRandomWordsPayment()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ì„¤ëª…í•˜ë©°, ì¸ìžë¡œ keyHash, callbackGasLimit, numWordsë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. ê²°ì œ ê¸ˆì•¡ì€ msg.valueë¥¼ í†µí•´ ì½”ë””ë„¤ì´í„° ì»¨íŠ¸ëž™íŠ¸ì˜ requestRandomWordsPayment()ë¡œ ì „ì†¡ë©ë‹ˆë‹¤. ê²°ì œ ê¸ˆì•¡ì´ ì˜ˆìƒ ê²°ì œ ê¸ˆì•¡ë³´ë‹¤ í´ ê²½ìš° ì´ˆê³¼ ê²°ì œ ê¸ˆì•¡ì€ requestRandomWordsPayment í•¨ìˆ˜ì˜ í˜¸ì¶œìžì—ê²Œ ë°˜í™˜ë˜ë¯€ë¡œ ì½”ë“œ ìƒë‹¨ì— í‘œì‹œëœ ê²ƒì²˜ëŸ¼ ì‚¬ìš©ìž ì»¨íŠ¸ëž™íŠ¸ì— [receive()](https://docs.soliditylang.org/en/v0.8.16/contracts.html#receive-ether-function) í•¨ìˆ˜ë¥¼ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.


## 4ë‹¨ê³„: ë¬´ìž‘ìœ„ ì›Œë“œ í• ë‹¹í•˜ê¸°

ì´ í•¨ìˆ˜ëŠ” ë‚œìˆ˜ ìš”ì²­ì„ ì´í–‰í•  ë•Œ VRFCoordinator ì»¨íŠ¸ëž™íŠ¸ì— ì˜í•´ í˜¸ì¶œë©ë‹ˆë‹¤.

```solidity
function fulfillRandomWords(
    uint256 /* requestId */,
    uint256[] memory randomWords
)
    internal
    override
{
    // requestId should be checked if it matches the expected request
    // Generate random value between 1 and 50.
    s_randomResult = (randomWords[0] % 50) + 1;
}
```

ì´ì œ Orakl VRF ì†”ë£¨ì…˜ ì½”ë“œê°€ ì™„ì„±ë˜ì—ˆìœ¼ë‹ˆ ì‹¤ì œë¡œ ìž‘ë™í•˜ëŠ” ëª¨ìŠµì„ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

# ì‹¤ì œ êµ¬í˜„

ì•„ëž˜ ì˜ˆì‹œì—ì„œ ì»¨íŠ¸ëž™íŠ¸ëŠ” ë‚œìˆ˜ë¥¼ ìš”ì²­í•˜ê³  ìš”ì²­ì„ ì´í–‰í•  ìˆ˜ ìžˆëŠ” ê¶Œí•œì„ ì œê³µí•©ë‹ˆë‹¤.

## ìƒ˜í”Œ ì½”ë“œ ìƒì„± ë° ë°°í¬

**Remix IDE**

* [Remix IDE](https://remix.ethereum.org/)ë¡œ ì´ë™í•©ë‹ˆë‹¤.
* File Explorer íƒ­ì„ í´ë¦­í•˜ê³  ì»¨íŠ¸ëž™íŠ¸ í´ë”ì— demoOraklDirectVRF.solì´ë¼ëŠ” ì´ë¦„ì˜ ìƒˆ íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.
* ìƒˆë¡œ ìƒì„±í•œ íŒŒì¼ì— ì•„ëž˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.
* Remixì—ì„œ **Compile contract**ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
* Klaytn í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•œ í›„ ì™¼ìª½ì˜ Klaytn íƒ­ì„ í´ë¦­í•©ë‹ˆë‹¤.
* **Environment** > **Injected Caver** - **Kaikas**ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
* Contractì—ì„œ ìœ„ì—ì„œ ìƒì„±í•œ ì»¨íŠ¸ëž™íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, VRFConsumer ì»¨íŠ¸ëž™íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤..
* ì½”ë””ë„¤ì´í„° ì»¨íŠ¸ëž™íŠ¸ ì£¼ì†Œ `0xfa605ca6dc9414e0f7fa322d3fd76535b33f7a4f`ì„ ìƒì„±ìž íŒŒë¼ë¯¸í„°ì— ìž…ë ¥í•©ë‹ˆë‹¤.
* **Deploy**ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

**ìƒ˜í”Œ ì½”ë“œ**

```solidity
// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.8.2 <0.9.0;
import "@bisonai/orakl-contracts/src/v0.1/VRFConsumerBase.sol";
import "@bisonai/orakl-contracts/src/v0.1/interfaces/VRFCoordinatorInterface.sol";
contract VRFConsumer is VRFConsumerBase {
  VRFCoordinatorInterface COORDINATOR;
  // stores random number after request;
  uint256 public s_randomResult;
  // stores owner
  address private sOwner;
   bytes32 keyHash = 0x47ede773ef09e40658e643fe79f8d1a27c0aa6eb7251749b268f829ea49f2024;
   uint32 callbackGasLimit = 500000;
   uint32 numWords = 1;
  error OnlyOwner(address notOwner);
  modifier onlyOwner() {
      if (msg.sender != sOwner) {
          revert OnlyOwner(msg.sender);
      }
      _;
  }
  constructor(address coordinator) VRFConsumerBase(coordinator) {
      COORDINATOR = VRFCoordinatorInterface(coordinator);
      sOwner = msg.sender;
  }
  // https://baobab.scope.klaytn.com/account/0xfa605ca6dc9414e0f7fa322d3fd76535b33f7a4f
  receive() external payable {}
function requestRandomWordsDirect()
    public
    payable
    onlyOwner
    returns (uint256 requestId)
{
  requestId = COORDINATOR.requestRandomWordsPayment{value: msg.value}(
    keyHash,
    callbackGasLimit,
    numWords
  );
}
function fulfillRandomWords(
    uint256 /* requestId */,
    uint256[] memory randomWords
)
    internal
    override
{
    // requestId should be checked if it matches the expected request
    // Generate random value between 1 and 50.
    s_randomResult = (randomWords[0] % 50) + 1;
}
}
```

![](../images/orakl-vrf-deploy.png)

## ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì™€ ìƒí˜¸ìž‘ìš©

ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì—ì„œ ë‚œìˆ˜ë¥¼ ìš”ì²­í•˜ë ¤ë©´ ë¨¼ì € `requestRandomWordsDirect()` í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë ¤ë©´ ì•žì„œ ì„¤ëª…í•œ ëŒ€ë¡œ ì‚¬ìš©ìžê°€ KLAY(ìµœì†Œ 1 KLAY)ë¥¼ ì „ì†¡í•´ì•¼ í•©ë‹ˆë‹¤. ì´í›„ ìš”ì²­ì´ ì™„ë£Œë˜ë©´ `s_randomResult()` í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì´ s_randomResult() í•¨ìˆ˜ëŠ” ë‚œìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

* **requestRandomWordsDirect()**: ì´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ 1 KLAYë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ì•„ëž˜ ì´ë¯¸ì§€ê°€ ì´ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤:

![](../images/orakl-vrf-request.png)

* **s_randomResult()**: VRFCoordinatorê°€ ë‚œìˆ˜ ìš”ì²­ì„ ìˆ˜í–‰í•œ í›„ ì‘ë‹µì€ s_randomResult ë³€ìˆ˜ì— ì €ìž¥ë©ë‹ˆë‹¤. ì‘ë‹µì„ ë°›ìœ¼ë ¤ë©´ `s_response()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.


![](../images/orakl-vrf-response.png)


ì§œìž” ðŸŽ‰! ë°©ê¸ˆ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì—ì„œ ë‚œìˆ˜ë¥¼ ìš”ì²­í•˜ì…¨ìŠµë‹ˆë‹¤.

# ê²°ë¡ 

ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” Orakl Network VRF ì†”ë£¨ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ëž™íŠ¸ì—ì„œ ë‚œìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤. Orakl NetworkëŠ” ê°€ê²© í”¼ë“œ, ë°ì´í„° ìš”ì²­-ì‘ë‹µ ë“± ë” ë§Žì€ ì˜¤ë¼í´ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. Orakle Networkì˜ ìžì„¸í•œ ê°€ì´ë“œì™€ ìž‘ë™ ë°©ì‹ì€ [Orakl Network ë¬¸ì„œ](https://docs.orakl.network/docs/developers-guide/readme)ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. 
